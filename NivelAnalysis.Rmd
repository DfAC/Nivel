---
title: "Nivel analysis"
author: "Kwabena/Chenyu"
output: html_document
---

```{r, echo=FALSE}
setwd("D:/H24VEP")
```

## Data collection


## Prepare dataset

First, we need to read collected Nivel data file. We use standard library to snoop through the data and get information we need: time and inclination values



```{r}
DataUrl<-file.path(getwd(),"data.log")
Data = read.table(DataUrl,header = F,sep = " ",strip.white=TRUE, stringsAsFactors = F, na.strings = c('X:+9.999',"Y:+9.999") )
```

Now we will:

* remove text in columns 3-5
* change 2nd column to time
* drop unneeded columns
* remame columns

Bridge axis is along the bridge (E) and to left (N). Nivelator axis are y along and x across but opposite to RTS coordinates.


```{r}
library("splitstackshape")
Data <- cSplit(Data, c("V3","V4"), c(":"), drop = TRUE, stripWhite= TRUE, type.convert = F)
Data$Time<-as.POSIXct(Data$V2, format="%H:%M:%S")
Data[,c("V2","V3_1","V4_1","V5")]<-list(NULL)

columnNames = c("unixTime","across","along","temperature","Time")
colnames(Data)<-columnNames
Data<-Data[complete.cases(Data)]

Data$unixTime <- Data$unixTime/100
Data$across<-as.numeric(Data$across)
Data$across<-as.numeric(Data$across)
#Data$temperature<-as.numeric(Data$temperature)



```





# Understanding data

* have we got axis properly?

```{r}
plot(Data$across,Data$along, main = "Data spread")
dev.copy(png,file = "plot1.png",width = 980, height = 980, units = "px", pointsize = 25)
dev.off() #close device
```


* how can we estimate precise time?

```{r}
timeCorrection <- ((Data$unixTime[1:(length(Data$unixTime)-1)]-Data$unixTime[2:(length(Data$unixTime))]))/100
Data$Time-timeCorrection

timeInSeconds = as.numeric(Data$Time)
```



* have we got any outlayers ?


# Time series

Cross plots

```{r}
#plot(Data)
```



```{r}
plot(Data$unixTime,Data$along, main = "Time series",xlab = "Unix time [??]", ylab = "Along [mrad]", ylim = c(-0.5,1))
dev.copy(png,file = "plot1.png",width = 980, height = 980, units = "px", pointsize = 25)
dev.off() #close device

plot(Data$unixTime,Data$across, main = "Time series",xlab = "Unix time [??]", ylab = "Across [mrad]")
dev.copy(png,file = "plot2.png",width = 980, height = 980, units = "px", pointsize = 25)
dev.off() #close device

```


```{r,echo=F}
plot(Data$Time,Data$along, main = "Time series",xlab = "Time [s]", ylab = "Along [mrad]", ylim = c(-0.5,1))
dev.copy(png,file = "plot1_time.png",width = 980, height = 980, units = "px", pointsize = 25)
dev.off() #close device

plot(Data$Time,Data$across, main = "Time series",xlab = "Unix time [??]", ylab = "Across [mrad]")
#daterange=c(as.POSIXlt(min(data$Time)),as.POSIXlt(max(data$Time))) 
#axis.POSIXct(1, at=seq(daterange[1], daterange[2], by="minute"), format="%H:%M:%S") #label the x axis by minutes
dev.copy(png,file = "plot1.png",width = 980, height = 980, units = "px", pointsize = 25)
dev.off() #close device

```

## Working on drift

```{r,Echo=False}
plot(Data$Time,Data$along, main = "Time series",xlab = "Time [s]", ylab = "Along [mrad]", ylim = c(-0.5,1))
dev.copy(png,file = "plot1_time.png",width = 980, height = 980, units = "px", pointsize = 25)
dev.off() #close device


```

